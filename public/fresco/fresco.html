<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particles Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            aspect-ratio: 1;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const data = urlParams.get('data');
        const cleanData = data ? parseInt(data.slice(0, -3)) % 21 : 0;
        console.log("data value sliced : " + cleanData);

        const displayFakeFresc = (parseInt(data.slice(0, -3)) < 0 || parseInt(data.slice(0, -3)) > 77);

        var particles = [];
        var nums;
        var particleDensity = 1234;
        var noiseScale = 999;
        var maxLife = 10;
        var simulationSpeed = 0.5;
        var fadeFrame = 0;
        var backgroundColor;
        var visualMode = 0;
        var numModes = 21; // Incremented from 4 to 5
        var visualModes;

        function checkTimeForInvertColors() {
            const now = new Date();
            const hour = now.getHours(); // gets the hour of the day in local time (0 - 23)
            const minu = now.getMinutes(); // gets the hour of the day in local time (0 - 23)
            return (hour === 5); // returns true if it's between 4 and 5 pm
        }
        const invertColors = checkTimeForInvertColors();


        function initializeVisualModes() {
            visualModes = [
                {
                    backgroundColor: color(0, 0, 10),
                    particleColors: [color(110, 57, 204), color(7, 153, 242), color(255, 255, 255)],
                },
                // 1 black white
                {
                    backgroundColor: color(10, 10, 20),
                    particleColors: [color(110, 57, 204), color(7, 153, 242), color(255, 255, 255)],
                },
                // 2 purple blue
                {
                    backgroundColor: color(10, 10, 20),
                    particleColors: [color(110, 57, 204), color(7, 153, 242), color(255, 255, 255)],
                },
                // 3 orange yellow red
                {
                    backgroundColor: color(10, 10, 20),
                    particleColors: [color(110, 57, 204), color(7, 153, 242), color(255, 255, 255)],
                },
                // 4 pink
                {
                    backgroundColor: color(10, 10, 20),
                    particleColors: [color(255, 100, 150), color(255, 100, 150), color(255, 255, 255)],
                },

                // 5 yellow purple
                {
                    backgroundColor: color(10, 10, 20),
                    particleColors: [color(110, 57, 204), color(7, 153, 242), color(255, 255, 255)],
                },
                // 6 red bg white grey line
                {
                    backgroundColor: color(100, 20, 20),
                    particleColors: [color(1, 2, 3), color(100, 100, 100), color(255, 255, 255)],
                },
                // 7 green neon
                {
                    backgroundColor: color(10, 10, 20),
                    particleColors: [color(210, 238, 130), color(210, 238, 130), color(255, 255, 255)],
                },
                // 8 chartreux bg gold orange A CHANGE
                {
                    backgroundColor: color(22, 50, 35),
                    particleColors: [color(1, 2, 3), color(100, 100, 100), color(255, 255, 255)],
                },
                // 9 
                {
                    backgroundColor: color(18, 12, 13),
                    particleColors: [color(0, 181, 204), color(0, 181, 204), color(137, 196, 244)],
                },
                //10 A CHANGE
                {
                    backgroundColor: color(30, 21, 111),
                    particleColors: [color(1, 2, 3), color(100, 100, 100), color(255, 255, 255)],
                },
                // 11 blue bg with pink, cyan, and purple lines
                {
                    backgroundColor: color(0, 0, 0),
                    particleColors: [color(255, 20, 150), color(0, 255, 255), color(128, 0, 128)],
                },
                // 12 grey bg with brown, cyan, and yellow lines
                {
                    backgroundColor: color(50, 50, 50),
                    particleColors: [color(165, 42, 42), color(0, 255, 255), color(255, 255, 0)],
                },
                // 13 black bg with gold, silver, and bronze lines
                {
                    backgroundColor: color(0, 0, 0),
                    particleColors: [color(255, 215, 0), color(192, 192, 192), color(205, 127, 50)],
                },
                // 14 teal bg with lavender, indigo, and beige lines
                {
                    backgroundColor: color(25, 0, 44),
                    particleColors: [color(245, 245, 220), color(230, 230, 250), color(245, 245, 220)],
                },
                // 15 Purple green BUZZ
                {
                    backgroundColor: color(11, 22, 33),
                    particleColors: [color(164, 224, 208), color(128, 224, 0), color(128, 0, 208)],
                },
                // 16 brown bg with coral, salmon, and tan lines
                {
                    backgroundColor: color(139, 69, 19),
                    particleColors: [color(255, 127, 80), color(250, 128, 114), color(210, 180, 140)],
                },

                // 17 crimson bg with spring green, sky blue, and chocolate lines
                {
                    backgroundColor: color(78, 78, 78),
                    particleColors: [color(10, 178, 10), color(178, 10, 10), color(10, 10, 178)],
                },
                // 18 lime bg with navy, goldenrod, and plum lines
                {
                    backgroundColor: color(0, 0, 0),
                    particleColors: [color(50, 205, 50), color(0, 210, 218), color(221, 160, 221)],
                },
                // 19 orchid bg with sienna, khaki, and pink lines
                {
                    backgroundColor: color(218, 112, 214),
                    particleColors: [color(160, 82, 45), color(240, 230, 140), color(255, 192, 203)],
                },
                // 20 slate gray bg with thistle, cadet blue, and dark salmon lines
                {
                    backgroundColor: color(12, 28, 44),
                    particleColors: [color(216, 191, 216), color(95, 158, 160), color(233, 150, 122)],
                }
            ]
        };

        function setup() {

            initializeVisualModes();
            nums = windowWidth * windowHeight / particleDensity;

            visualMode = cleanData % numModes; // Moved this line up
            if (visualMode < visualModes.length) { // Check if visualMode exists
                backgroundColor = visualModes[visualMode].backgroundColor;
            } else {
                console.error('Visual mode index out of bounds');
                return; // Exit if error occurs
            }

            createCanvas(windowWidth, windowHeight);
            background(backgroundColor);
            for (var i = 0; i < nums; i++) {
                particles[i] = new Particle();
            }
        }
        let getHereLink = "https://twitter.com/recursivepsyop";  // The URL you want to redirect to
        let getHereBox;  // To keep track of the clickable area

        function drawFakeFrescText() {
            push(); // Save current drawing style

            textAlign(CENTER, CENTER); // Center align horizontally and vertically

            // Draw "FAKE FRESC" text
            textSize(36);
            fill(255, 21, 21);
            stroke(218);
            strokeWeight(4);
            text("NOT AUTHENTIC", width / 2, height / 2 - 25);  // Shifted up a bit to make space for the link below

            // Draw "GET HERE" text and calculate its clickable area
            textSize(24);
            let getHereX = width / 2;
            let getHereY = height / 2 + 25;  // Shifted down
            text("View the FRESC Collection", getHereX, getHereY);

            let textBoxWidth = textWidth("GET HERE");
            getHereBox = {
                x: getHereX - textBoxWidth / 2,
                y: getHereY - 12, // Roughly half the textSize
                w: textBoxWidth,
                h: 24 // Same as textSize
            };

            pop(); // Restore previous drawing style
        }

        function mouseClicked() {
            // Check if the mouse click is inside the "GET HERE" text box
            if (getHereBox && mouseX > getHereBox.x && mouseX < getHereBox.x + getHereBox.w &&
                mouseY > getHereBox.y && mouseY < getHereBox.y + getHereBox.h) {
                window.open(getHereLink, "_blank");  // Open in a new tab. Use "_self" if you want to open in the same tab.
            }
        }


        function draw() {
            if (displayFakeFresc) {
                drawFakeFrescText();
            }
            else {
                noStroke();

                ++fadeFrame;
                if (fadeFrame % 5 == 0) {
                    if (invertColors) {
                        blendMode(ADD);
                    } else {
                        blendMode(DIFFERENCE);
                    }
                    fill(1, 1, 1);
                    rect(0, 0, width, height);

                    if (invertColors) {
                        blendMode(DARKEST);
                    } else {
                        blendMode(LIGHTEST);
                    }
                    fill(backgroundColor);
                    rect(0, 0, width, height);
                }


            }

            blendMode(BLEND);
            smooth();
            for (var i = 0; i < nums; i++) {
                var iterations = map(i, 0, nums, 5, 1);
                // var radius = map(i, 0, nums, 1, 2);
                var radius = map(i, 0, nums, 7, 1);

                particles[i].move(iterations);
                particles[i].checkEdge();

                var alpha = 255;
                var particleColor;
                var fadeRatio;
                fadeRatio = min(particles[i].life * 5 / maxLife, 1);
                fadeRatio = min((maxLife - particles[i].life) * 5 / maxLife, fadeRatio);
                var colorCase = visualMode;
                if (visualMode == 0) {
                    colorCase = int(particles[i].pos.x / width * 3) + 1;
                }
                switch (colorCase) {
                    case 1:
                        var lifeRatioGrayscale = min(255, (255 * particles[i].life / maxLife) + red(backgroundColor));
                        particleColor = color(lifeRatioGrayscale, alpha * fadeRatio);
                        break;
                    case 2:
                        particleColor = particles[i].color;
                        break;
                    case 3:
                        particleColor = color(blue(particles[i].color) + 70, green(particles[i].color) + 20, red(particles[i].color) - 50);
                        break;
                    case 4:
                        particleColor = particles[i].color; // This is an example pink color.
                        break;
                    case 5:
                        particleColor = color(blue(particles[i].color) + 10, green(particles[i].color) + 20, red(particles[i].color) + 50);

                        break;
                    case 6:
                        particleColor = particles[i].color;

                        break;
                    case 7:
                        particleColor = particles[i].color;
                        break;
                    case 8:
                        particleColor = particles[i].color;
                        break;
                    case 9:
                        particleColor = particles[i].color;
                        break;
                    case 10:
                        particleColor = particles[i].color;
                        break;
                    case 11:
                        particleColor = particles[i].color;
                        break;
                    case 12:
                        particleColor = particles[i].color;
                        break;
                    case 13:
                        particleColor = particles[i].color;
                        break;
                    case 14:
                        particleColor = particles[i].color;
                        break;
                    case 15:
                        particleColor = particles[i].color;
                        break;
                    case 16:
                        particleColor = particles[i].color;
                        break;
                    case 17:
                        particleColor = particles[i].color;
                        break;
                    case 18:
                        particleColor = particles[i].color;
                        break;
                    case 19:
                        particleColor = particles[i].color;
                        break;
                    case 20:
                        particleColor = particles[i].color;
                        break;
                    case 21:
                        particleColor = particles[i].color;
                        break;

                }
                if (invertColors) {
                    particleColor = color(255 - red(particleColor), 255 - green(particleColor), 255 - blue(particleColor));
                }
                fill(red(particleColor), green(particleColor), blue(particleColor), alpha * fadeRatio);
                particles[i].display(radius);
            }
        }

        function Particle() {
            this.vel = createVector(0, 0);
            this.pos = createVector(random(0, width), random(0, height));
            this.life = random(0, maxLife);
            this.flip = int(random(0, 2)) * 2 - 1;
            var randColor = int(random(0, visualModes[visualMode].particleColors.length));
            if (visualMode < visualModes.length && randColor < visualModes[visualMode].particleColors.length) {
                this.color = visualModes[visualMode].particleColors[randColor];
            } else {
                console.error('Particle color assignment error.');
                this.color = color(255, 255, 255); // Default color in case of an error
            }


            this.move = function (iterations) {
                if ((this.life -= 0.06667) < 0)
                    this.respawn();
                while (iterations > 0) {
                    var angle = 0;

                    angle = noise(this.pos.x / noiseScale, this.pos.y / noiseScale) * TWO_PI * noiseScale * this.flip;
                    this.vel.x = cos(angle);
                    this.vel.y = sin(angle);
                    this.vel.mult(simulationSpeed);
                    this.pos.add(this.vel);
                    --iterations;
                }
            }

            this.checkEdge = function () {
                if (this.pos.x > width || this.pos.x < 0 || this.pos.y > height || this.pos.y < 0) {
                    this.respawn();
                }
            }

            this.respawn = function () {
                this.pos.x = random(0, width);
                this.pos.y = random(0, height);
                this.life = maxLife;
            }

            this.display = function (r) {
                ellipse(this.pos.x, this.pos.y, r, r);
            }


        }

        function advanceVisual() {
            visualMode = (visualMode + 1) % visualModes.length;
            backgroundColor = visualModes[visualMode].backgroundColor;
            noiseSeed(random() * Number.MAX_SAFE_INTEGER);
            background(backgroundColor);
            for (var i = 0; i < nums; i++) {
                particles[i].respawn();
                particles[i].life = random(0, maxLife);
            }
        }



    </script>
</body>

</html>